<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <add name="httpPlatformHandler" path="*" verb="*" modules="httpPlatformHandler" resourceType="Unspecified" requireAccess="Script" />
    </handlers>

    <httpPlatform stdoutLogEnabled="false" stdoutLogFile=".\node.log" startupTimeLimit="20" processPath="node.exe" arguments=".\server.js">
      <environmentVariables>
        <environmentVariable name="PORT" value="%HTTP_PLATFORM_PORT%" />
        <environmentVariable name="NODE_ENV" value="Production" />
      </environmentVariables>
    </httpPlatform>

    <httpProtocol>
      <customHeaders>
        <!-- Prevent clickjacking -->
        <add name="X-Frame-Options" value="SAMEORIGIN" />
        <!-- Prevent MIME-sniffing -->
        <add name="X-Content-Type-Options" value="nosniff" />
        <!-- Referrer Policy -->
        <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
        <!-- Content Security Policy -->
        <add name="Content-Security-Policy" value="
          default-src 'self';
          script-src 'self' 'unsafe-inline'
            https://www.googletagmanager.com
            https://www.google-analytics.com
            https://www.google.com
            https://www.gstatic.com
            https://login-ds.dotomi.com/
            https://static.ads-twitter.com
            https://connect.facebook.net
            https://s7.addthis.com
            https://tags.bkrtx.com
            https://sc-static.net
            https://login.dotomi.com
            https://googleads.g.doubleclick.net
            https://ad.doubleclick.net
            https://tr.snapchat.com;
          style-src 'self' 'unsafe-inline';
          img-src 'self' data: https:;
          font-src 'self' data:;
          connect-src 'self'
            https://culturesummit-apim.azure-api.net
            https://apim.dct.gov.ae
            https://apim.dctt.gov.ae
            https://ad.doubleclick.net
            https://tr6.snapchat.com
            https://analytics.google.com
            https://www.google-analytics.com
            https://googleads.g.doubleclick.net
            https://stats.g.doubleclick.net
            https://login.dotomi.com
            https://www.google.com
            https://tr.snapchat.com;
          frame-src
            https://www.google.com
            https://www.gstatic.com
            https://www.googletagmanager.com
            https://td.doubleclick.net
            https://8242311.fls.doubleclick.net
            https://ad.doubleclick.net;
        " />
      </customHeaders>
    </httpProtocol>

    <rewrite>
      <outboundRules>
        <rule name="Add HSTS for Production" preCondition="IsProduction">
          <match serverVariable="RESPONSE_Strict_Transport_Security" pattern=".*" />
          <action type="Rewrite" value="max-age=31536000; includeSubDomains" />
        </rule>
        <preConditions>
          <preCondition name="IsProduction">
            <add input="{HTTP_HOST}" pattern="^culturesummitabudhabi\.com$" />
          </preCondition>
        </preConditions>
      </outboundRules>
    </rewrite>

  </system.webServer>
</configuration>
